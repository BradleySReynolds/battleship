(()=>{"use strict";function t(){let t=[];for(let e=0;e<10;e++){let e=[];for(let t=0;t<10;t++)e.push("o");t.push(e)}return t}class e{constructor(t,e){this.name=t,this.length=e,this.location=[]}}class r{constructor(){this.board=t(),this.ships=[new e("Carrier",5),new e("Battleship",4),new e("Destroyer",3),new e("Submarine",3),new e("Patrol Boat",2)],this.hits=0}positionShips(){this.ships.forEach((t=>{let e,r,o,i=!1;t:for(;!i;){if(o=Math.floor(2*Math.random()),e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),0===o){if(e+t.length>9){for(let o=t.length;o>0;o--)if("x"===this.board[r][e-o])continue t}else for(let o=0;o<t.length;o++)if(t.location.push([e+o,r]),"x"===this.board[r][e+o])continue t}else if(r+t.length>9){for(let o=t.length;o>0;o--)if("x"===this.board[r-o][e])continue t}else for(let o=0;o<t.length;o++)if("x"===this.board[r+o][e])continue t;i=!0}if(0===o)if(e+t.length>9)for(let o=t.length;o>0;o--)t.location.push([e-o,r]),this.board[r][e-o]="x";else for(let o=0;o<t.length;o++)t.location.push([e+o,r]),this.board[r][e+o]="x";else if(r+t.length>9)for(let o=t.length;o>0;o--)t.location.push([e,r-o]),this.board[r-o][e]="x";else for(let o=0;o<t.length;o++)t.location.push([e,r+o]),this.board[r+o][e]="x"}))}isHit(){this.hits++}}class o{constructor(){this.board=t(),this.ships=[new e("Carrier",5),new e("Battleship",4),new e("Destroyer",3),new e("Submarine",3),new e("Patrol Boat",2)],this.hits=0}boardLogic(t,e,r,o,i){if(5===o)return 0;if("horizontal"===t)if(r+this.ships[o].length>9)for(let t=0;t<this.ships[o].length;t++)"placed"!==this.board[e][r-t]&&(this.board[e][r-t]=i);else for(let t=0;t<this.ships[o].length;t++)"placed"!==this.board[e][r+t]&&(this.board[e][r+t]=i);else if(e+this.ships[o].length>9)for(let t=0;t<this.ships[o].length;t++)"placed"!==this.board[e-t][r]&&(this.board[e-t][r]=i);else for(let t=0;t<this.ships[o].length;t++)"placed"!==this.board[e+t][r]&&(this.board[e+t][r]=i)}isHit(){this.hits++}placeShips(){let t=0,e="horizontal";const r=document.querySelectorAll(".player-square"),o=document.querySelector(".invert");o.addEventListener("click",(()=>{e="horizontal"===e?"vertical":"horizontal",o.textContent=`${e}`})),r.forEach((o=>{o.addEventListener("mouseenter",(o=>{let i=o.target,s=Number(i.getAttribute("x")),n=Number(i.getAttribute("y"));this.boardLogic(e,s,n,t,"hovered"),o.stopImmediatePropagation(),this.renderBoard(r)}))})),r.forEach((o=>{o.addEventListener("mouseleave",(o=>{let i=o.target,s=Number(i.getAttribute("x")),n=Number(i.getAttribute("y"));this.boardLogic(e,s,n,t,"exit"),o.stopImmediatePropagation(),this.renderBoard(r)}))}));const i=s=>{const n=document.querySelector(".player-instruct");let a=s.target,l=Number(a.getAttribute("x")),h=Number(a.getAttribute("y"));if(this.boardLogic(e,l,h,t,"placed"),s.stopImmediatePropagation(),this.renderBoard(r),r.forEach((t=>{t.addEventListener("click",i)})),t++,t>=5){const t=document.querySelector(".computer-container");r.forEach((t=>{t.style.pointerEvents="none"})),t.style.display="flex",n.remove(),o.remove()}t<5&&(n.textContent=`Place your ${this.ships[t].name}`)};r.forEach((t=>{t.addEventListener("click",i)}))}renderBoard(t){const e={hovered:"ship-hit",placed:"ship-placed",exit:"ship-empty"};this.board.flat().forEach(((r,o)=>{const i=t[o],s=e[r];i.classList.remove("ship-placed","ship-hit","ship-empty"),i.classList.add(s),"placed"===r&&(i.textContent="x")}))}}class i{constructor(t,e){this.player=t,this.computer=e,this.turn=!0,this.gameover=!1,this.computerMoves=[],this.winner=null}checkwin(){17===this.player.hits?(this.gameover=!0,this.winner="Computer"):17===this.computer.hits&&(this.gameover=!0,this.winner="Player"),!0===this.gameover&&(document.createElement("button"),document.body.innerHTML="",document.body.innerHTML=`\n      <div class="winner-container">\n        <p class='winner-text'>The ${this.winner} wins!</p>\n        <button class="winner-btn">Play Again</button>\n      </div>`,document.querySelector(".winner-btn").addEventListener("click",(()=>{location.reload()})))}computerMove(){if(!1===this.gameover){const t=document.querySelectorAll(".player-square");let e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());this.computerMoves.includes(JSON.stringify([e,r]))?this.computerMove():("w"===this.player.board[r][e]?(this.player.isHit(),this.player.board[r][e]="i",this.player.board.flat().forEach(((e,r)=>{"i"===e&&(t[r].style.textContent="x",t[r].style.color="red")}))):(this.player.board[r][e]="m",this.player.board.flat().forEach(((e,r)=>{"m"===e&&(t[r].style.textContent="o",t[r].style.color="black")}))),this.computerMoves.push(JSON.stringify([e,r])))}}}!function(){const t=document.querySelector(".computer-board"),e=document.querySelector(".player-board"),s=new r,n=new o,a=new i(n,s);n.board.forEach(((t,r)=>t.forEach(((t,o)=>{let i=document.createElement("div");i.classList.add("player-square"),i.setAttribute("x",r),i.setAttribute("y",o),i.textContent=n.board[r][o],e.append(i)})))),n.placeShips(),s.positionShips(),s.board.forEach(((e,r)=>e.forEach(((e,o)=>{let i=document.createElement("div");i.classList.add("square"),i.textContent=s.board[r][o],t.append(i)}))));const l=document.querySelectorAll(".square"),h=document.querySelectorAll(".player-square");l.forEach((t=>{t.addEventListener("click",(function t(e){"x"===e.target.textContent?(e.target.style.color="red",s.isHit()):e.target.style.color="black",console.log(n.hits,s.hits),a.checkwin(),a.computerMove(),n.renderBoard(h),e.target.removeEventListener("click",t)}))}))}()})();